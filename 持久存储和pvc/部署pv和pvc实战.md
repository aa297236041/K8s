### 实验环境：

    - k8s集群：3台centos7.9 虚拟机，1个master节点,2个node节点
      k8s version：v1.20
搭建 k8s 集群：可以参考 [k8s部署安装.md](https://github.com/aa297236041/K8s-/blob/main/k8s%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85.md)


1、理论基础

1.数据持久化的目的

通常情况下，容器运行起来后，写入到其容器内部的文件是暂时性的。当容器崩溃后，k8s将这个容器kill掉，然后生成一个新的容器，此时，新运行的容器将没有原来容器内的文件，因为容器是从镜像重新创建的。 （容器一旦重启或者被删除了，里面存放的数据是会被销毁的）
数据共享：同一个pod中运行的容器之间，经常会存在共享文件或目录的需求，比如采集容器和主容器

2.生命周期
k8s里面的volume数据卷存在明确的生命周期，并且volume的生命周期比同一容器组pod中的任意容器的生命周期都要长。不管容器本身重启了多少次，数据都被保留下来。当然，pod如果不存在了，数据卷自然就退出了。

注意：可以定义pod所使用的数据卷类型不同，数据可能随着数据卷的退出而删除，也可能被真正的持久化，即使后期重新使用容器时仍然可以使用该数据卷，下面有例子。

3.pv和pvc
数据卷在k8s生产中用的最多的还是PV和PVC (PersistentVolume和PersistentVolumeClaim)。在企业里面，PV由运维工程师来进行维护（存储工程师），而PVC则是由开发人员自己申请使用即可。其中PV是具有持久性的，生命周期独立于Pod，研发人员需要进行一个容器的数据卷挂载，那么写一个PVC来绑定PV就可以了，k8s自身会查找符合条件的PV。

有了pvc，我们在K8s进行卷挂载就只需要考虑要多少容量了，而不用关心真正的空间是用什么存储系统做的等一些底层细节信息，pv这些只有存储管理员才应用去关心它。

K8s支持多种类型的pv，我们这里就以生产中常用的NFS来作演示（在云上的话就用NAS，我们使用了阿里云的NAS），生产中如果对存储要求不是太高的话，建议就用NFS，这样出问题也比较容易解决，如果有性能需求，可以看看rook的ceph。

这里列出了阿里云的NAS相关的性能，价格信息，供大家参考

1.通用型NAS存储(性价比高，可以存放web内容管理，数据库备份，日志存储等。)：

通用型：容量是1~10PB，读带宽150MBps/TiB，最大IOPS是15K。价格是0.35元/GiB/月
性能型：容量是1PB，读带宽600MBps/TiB，最大IOPS是30K。价格是1.85元/GiB/月
2.极速型NAS(低时延，高性能WEB服务，数据库)：

容量：100GiB256TiB，带宽150MB/s 1200MB/s，最大IOPS是200K，时延0.2ms。价格是1.8元/GiB/月
